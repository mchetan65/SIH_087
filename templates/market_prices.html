{% extends 'base.html' %}
{% block content %}
<h2 class="text-2xl font-bold mb-4">Market Prices</h2>

<div class="mb-4">
  <label for="crop" class="block mb-1 font-semibold">Select Crop</label>
  <select id="crop" class="border rounded p-2 w-64">
    <option value="rice">Rice</option>
    <option value="wheat">Wheat</option>
    <option value="maize">Maize</option>
    <option value="potato">Potato</option>
  </select>
  <button id="btnFetch" class="bg-purple-600 text-white px-4 py-2 rounded ml-2">Get Prices</button>
</div>

<div id="pricesInfo" class="bg-white p-4 rounded shadow hidden">
  <h3 class="font-semibold mb-2">Current Market Prices</h3>
  <div class="grid grid-cols-2 gap-4">
    <div class="bg-purple-100 p-4 rounded">
      <div class="text-2xl font-bold" id="price">-</div>
      <div>Price per kg (â‚¹)</div>
    </div>
    <div class="bg-blue-100 p-4 rounded">
      <div class="text-2xl font-bold" id="trend">-</div>
      <div>Trend</div>
    </div>
  </div>
  <div class="mt-4">
    <h4 class="font-semibold">Market Insights</h4>
    <p id="insights">-</p>
  </div>
</div>

<script>
async function fetchPrices(crop) {
  const res = await fetch(`/api/market-prices?crop=${encodeURIComponent(crop)}`);
  if (!res.ok) {
    alert('Failed to fetch market prices');
    return;
  }
  const data = await res.json();
  if (data.error) {
    alert(data.error);
    return;
  }
  document.getElementById('price').textContent = data.price;
  document.getElementById('trend').textContent = data.trend;
  document.getElementById('insights').textContent = data.insights;
  document.getElementById('pricesInfo').classList.remove('hidden');
}

document.getElementById('btnFetch').addEventListener('click', () => {
  const crop = document.getElementById('crop').value;
  if (crop) {
    fetchPrices(crop);
  }
});
</script>
{% endblock %}
